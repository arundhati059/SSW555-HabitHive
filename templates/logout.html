{% extends "base.html" %}

{% block title %}Logging Out - HabitHive{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6 col-lg-4">
        <div class="card shadow">
            <div class="card-header bg-info text-white text-center">
                <h4>üëã Signing Out</h4>
                <p class="mb-0">Please wait while we sign you out...</p>
            </div>
            <div class="card-body text-center">
                <div id="logoutStatus" class="alert alert-info">
                    <div class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></div>
                    Signing out...
                </div>
            </div>
        </div>
    </div>
</div>

<script type="module">
    document.addEventListener('DOMContentLoaded', async function() {
        const statusDiv = document.getElementById('logoutStatus');
        
        try {
            // Wait for Firebase auth to be available
            const waitForFirebaseAuth = () => {
                return new Promise((resolve) => {
                    const checkAuth = () => {
                        if (window.firebaseAuth) {
                            resolve();
                        } else {
                            setTimeout(checkAuth, 100);
                        }
                    };
                    checkAuth();
                });
            };

            await waitForFirebaseAuth();
            
            // Import Firebase signOut function
            const { signOut } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js');
            
            // Sign out from Firebase
            await signOut(window.firebaseAuth);
            
            // Update status
            statusDiv.innerHTML = '<div class="text-success">‚úÖ Successfully signed out!</div>';
            
            // Redirect to login after a short delay
            setTimeout(() => {
                window.location.href = '/login';
            }, 1500);
            
        } catch (error) {
            console.error('Logout error:', error);
            statusDiv.innerHTML = '<div class="text-warning">‚ö†Ô∏è Logout completed (with minor issues)</div>';
            
            // Still redirect to login even if there's an error
            setTimeout(() => {
                window.location.href = '/login';
            }, 2000);
        }
    });
</script>
{% endblock %}