{% extends "base_dashboard.html" %}
{% set p = profile or {} %}

{% block title %}Edit Profile • HabitHive{% endblock %}

{% block content %}
<div class="dashboard-inner">

    <h2 class="page-title mb-4">
        <i class="fas fa-user-edit me-2"></i> Edit Profile
    </h2>

    <div class="card shadow-sm">
        <div class="card-body">

            <!-- ===========================
                 PROFILE EDIT FORM
            ============================ -->
            <form method="POST" enctype="multipart/form-data">

                <!-- Avatar -->
                <div class="text-center mb-4">

                    <img id="avatarPreview"
                         src="{{ p.avatar_url or '/static/img/default-avatar.png' }}"
                         class="rounded-circle"
                         width="130"
                         height="130"
                         style="border:3px solid #eaeaea; object-fit:cover;">

                    <div class="mt-3">
                        <label class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-upload me-1"></i> Change Avatar
                            <input type="file"
                                   name="avatar"
                                   id="avatarInput"
                                   accept="image/*"
                                   style="display:none;">
                        </label>
                    </div>

                    <small class="text-muted d-block mt-2">
                        Recommended: Square • PNG/JPG • Max 2MB
                    </small>
                </div>

                <!-- Email (locked) -->
                <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input class="form-control"
                           value="{{ p.email }}"
                           disabled>
                </div>

                <!-- Full Name (locked) -->
                <div class="mb-3">
                    <label class="form-label">Full Name</label>
                    <input class="form-control"
                           value="{{ (p.first_name ~ ' ' ~ p.last_name).strip() }}"
                           disabled>
                </div>

                <!-- Username -->
                <div class="mb-3">
                    <label class="form-label">Username</label>
                    <input name="display_name"
                           class="form-control"
                           value="{{ p.display_name or p.username }}"
                           placeholder="Enter username..."
                           required>
                </div>

                <button class="btn btn-primary w-100 mt-3">
                    <i class="fas fa-save me-1"></i> Save Changes
                </button>

            </form>

        </div>
    </div>

</div>

<!-- Avatar Preview Script -->
<script>
document.getElementById("avatarInput").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;
    document.getElementById("avatarPreview").src = URL.createObjectURL(file);
});
</script>

{% endblock %}
