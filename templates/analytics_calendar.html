{% extends "base_dashboard.html" %}

{% block title %}Calendar Habit Analytics{% endblock %}

{% block content %}
<div class="analytics-container">

    <h2 class="page-title">ðŸ“… Calendar Habit Analytics</h2>

    <p class="subtitle">Last 30 Days Heatmap</p>

    <div id="calendar-heatmap" class="calendar-grid"></div>

</div>
{% endblock %}

{% block scripts %}
<script>
// Completed dates passed from Flask
const completed = new Set({{ completed_dates|tojson|safe }});

// Get last N days
function lastNDays(n) {
    let arr = [];
    let today = new Date();
    for (let i = 0; i < n; i++) {
        let d = new Date();
        d.setDate(today.getDate() - i);
        arr.push(new Date(d));
    }
    return arr.reverse();
}

// Format date YYYY-MM-DD
function formatDate(d) {
    return d.toISOString().split("T")[0];
}

// Render the calendar heatmap
function renderCalendar() {
    const container = document.getElementById("calendar-heatmap");
    const days = lastNDays(30);

    let html = "";

    days.forEach(d => {
        let dateStr = formatDate(d);
        let done = completed.has(dateStr);

        html += `
            <div class="day-box ${done ? "done" : ""}" 
                 title="${dateStr} â€” ${done ? "Completed âœ”" : "Not Completed"}">
            </div>
        `;
    });

    container.innerHTML = html;
}

renderCalendar();
</script>


<style>
.analytics-container {
    margin: 40px auto;
    max-width: 900px;
}

.page-title {
    font-size: 28px;
    font-weight: 700;
    color: #333;
}

.subtitle {
    margin-bottom: 20px;
    color: #666;
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(15, 20px);
    gap: 6px;
    margin-top: 20px;
}

.day-box {
    width: 20px;
    height: 20px;
    background: #e0e0e0;
    border-radius: 4px;
    transition: 0.25s ease;
}

.day-box.done {
    background: #6a5af9;
    box-shadow: 0 0 6px rgba(106,90,249,0.6);
}

.day-box:hover {
    transform: scale(1.2);
    cursor: pointer;
}
</style>
{% endblock %}
